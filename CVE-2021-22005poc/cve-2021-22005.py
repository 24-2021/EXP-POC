import sys
import requests
import time
import urllib3
urllib3.disable_warnings()

a= '''

  $$$   $$  $$  $$$$$        $$$    $$$    $$$     $$         $$$    $$$    $$$    $$$   $$$$$ 
 $$  $  $$  $$  $$          $  $$  $$ $$  $  $$   $$$        $  $$  $  $$  $$ $$  $$ $$  $$    
 $$     $$  $$  $$             $$  $$ $$     $$    $$           $$     $$  $$ $$  $$ $$  $$$$  
 $$      $$$$   $$$$$         $$   $$ $$    $$     $$          $$     $$   $$ $$  $$ $$     $$ 
 $$      $$$$   $$           $$    $$ $$   $$      $$         $$     $$    $$ $$  $$ $$     $$ 
 $$  $   $$$$   $$          $$     $$ $$  $$       $$        $$     $$     $$ $$  $$ $$  $  $$ 
  $$$     $$    $$$$$       $$$$$   $$$   $$$$$   $$$$       $$$$$  $$$$$   $$$    $$$    $$$  

'''
print(a)

def vcenter_upload(txt):
    uri = '/analytics/telemetry/ph/api/hyper/send?_c&_i=test'

    headers= {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4298.0 Safari/537.36',
    }
    data = 'test'
    f = open(txt)
    for url in f:
        url = url.strip('\n')
        all = url + uri
        try:
            req = requests.post(all,data=data,headers=headers,verify=False,timeout=1) #headers=headers,
            time.sleep(0.5)
            code = req.status_code

            if code ==201:
                print(f'[+]{url} 疑似存在漏洞！！！')
                f2 =open('漏洞列表.txt','a+')
                f2.write(url+'\n')
                f2.close()
            else:
                print(f'[-]{url} 不存在漏洞！！！')
        except:
            print(f'[-]{url} 请求错误！！！')
            continue
    f.close()


if __name__ == '__main__' :
    try:
        cmd1 = sys.argv[1]
        vcenter_upload(cmd1)
    except:
        print('python3 cve-2021-22005.py url.txt')